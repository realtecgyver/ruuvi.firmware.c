
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>app_sensor.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#ifndef APP_SENSOR_H</a>
<a name="ln2">#define APP_SENSOR_H</a>
<a name="ln3">/**</a>
<a name="ln4"> * @addtogroup app</a>
<a name="ln5"> */</a>
<a name="ln6">/** @{ */</a>
<a name="ln7">/**</a>
<a name="ln8"> * @defgroup app_sensor Application sensor control</a>
<a name="ln9"> * @brief Initialize, configure and read sensors.</a>
<a name="ln10"> */</a>
<a name="ln11">/** @} */</a>
<a name="ln12">/**</a>
<a name="ln13"> * @addtogroup app_sensor</a>
<a name="ln14"> */</a>
<a name="ln15">/** @{ */</a>
<a name="ln16">/**</a>
<a name="ln17"> * @file app_sensor.h</a>
<a name="ln18"> * @author Otso Jousimaa &lt;otso@ojousima.net&gt;</a>
<a name="ln19"> * @date 2020-04-16</a>
<a name="ln20"> * @copyright Ruuvi Innovations Ltd, license BSD-3-Clause.</a>
<a name="ln21"> *</a>
<a name="ln22"> * Typical usage:</a>
<a name="ln23"> * @code{.c}</a>
<a name="ln24"> * TODO</a>
<a name="ln25"> * @endcode</a>
<a name="ln26"> */</a>
<a name="ln27"> </a>
<a name="ln28">#include &quot;app_config.h&quot;</a>
<a name="ln29">#include &quot;ruuvi_boards.h&quot;</a>
<a name="ln30">#include &quot;ruuvi_driver_error.h&quot;</a>
<a name="ln31">#include &quot;ruuvi_interface_communication.h&quot;</a>
<a name="ln32">#include &quot;ruuvi_interface_communication_radio.h&quot;</a>
<a name="ln33">#include &quot;ruuvi_task_sensor.h&quot;</a>
<a name="ln34">#include &quot;ruuvi_interface_environmental_mcu.h&quot;</a>
<a name="ln35">#include &quot;ruuvi_interface_tmp117.h&quot;</a>
<a name="ln36"> </a>
<a name="ln37">#define APP_SENSOR_SELFTEST_RETRIES (5U) //!&lt; Number of times to retry init on self-test fail.</a>
<a name="ln38">#define APP_SENSOR_HANDLE_UNUSED    RD_HANDLE_UNUSED</a>
<a name="ln39"> </a>
<a name="ln40">enum</a>
<a name="ln41">{</a>
<a name="ln42">#if APP_SENSOR_TMP117_ENABLED</a>
<a name="ln43">    TMP117_INDEX,</a>
<a name="ln44">#endif</a>
<a name="ln45">#if APP_SENSOR_SHTCX_ENABLED</a>
<a name="ln46">    SHTCX_INDEX,</a>
<a name="ln47">#endif</a>
<a name="ln48">#if APP_SENSOR_DPS310_ENABLED</a>
<a name="ln49">    DPS310_INDEX,</a>
<a name="ln50">#endif</a>
<a name="ln51">#if APP_SENSOR_BME280_ENABLED</a>
<a name="ln52">    BME280_INDEX,</a>
<a name="ln53">#endif</a>
<a name="ln54">#if APP_SENSOR_NTC_ENABLED</a>
<a name="ln55">    NTC_INDEX,</a>
<a name="ln56">#endif</a>
<a name="ln57">#if APP_SENSOR_PHOTO_ENABLED</a>
<a name="ln58">    PHOTO_INDEX,</a>
<a name="ln59">#endif</a>
<a name="ln60">#if APP_SENSOR_ENVIRONMENTAL_MCU_ENABLED</a>
<a name="ln61">    ENV_MCU_INDEX,</a>
<a name="ln62">#endif</a>
<a name="ln63">#if APP_SENSOR_LIS2DH12_ENABLED</a>
<a name="ln64">    LIS2DH12_INDEX,</a>
<a name="ln65">#endif</a>
<a name="ln66">#if APP_SENSOR_LIS2DW12_ENABLED</a>
<a name="ln67">    LIS2DW12_INDEX,</a>
<a name="ln68">#endif</a>
<a name="ln69">    SENSOR_COUNT</a>
<a name="ln70">};</a>
<a name="ln71"> </a>
<a name="ln72">#ifdef CEEDLING</a>
<a name="ln73">void m_sensors_init (void); //!&lt; Give Ceedling a handle to initialize structs.</a>
<a name="ln74">#endif</a>
<a name="ln75"> </a>
<a name="ln76">#if APP_SENSOR_BME280_ENABLED</a>
<a name="ln77">#if RB_ENVIRONMENTAL_BME280_SPI_USE</a>
<a name="ln78">#define BME_BUS RD_BUS_SPI</a>
<a name="ln79">#define BME_HANDLE RB_SPI_SS_ENVIRONMENTAL_PIN</a>
<a name="ln80">#elif RB_ENVIRONMENTAL_BME280_I2C_USE</a>
<a name="ln81">#define BME_BUS RD_BUS_I2C</a>
<a name="ln82">#define BME_HANDLE RB_BME280_I2C_ADDRESS</a>
<a name="ln83">#else</a>
<a name="ln84">#error &quot;No bus defined for BME280&quot;</a>
<a name="ln85">#endif</a>
<a name="ln86"> </a>
<a name="ln87">#define APP_SENSOR_BME280_DEFAULT_CFG                     \</a>
<a name="ln88">  {                                                       \</a>
<a name="ln89">    .sensor = {0},                                        \</a>
<a name="ln90">    .init = &amp;ri_bme280_init,                              \</a>
<a name="ln91">    .configuration =                                      \</a>
<a name="ln92">        {                                                 \</a>
<a name="ln93">            .dsp_function = APP_SENSOR_BME280_DSP_FUNC,   \</a>
<a name="ln94">            .dsp_parameter = APP_SENSOR_BME280_DSP_PARAM, \</a>
<a name="ln95">            .mode = APP_SENSOR_BME280_MODE,               \</a>
<a name="ln96">            .resolution = APP_SENSOR_BME280_RESOLUTION,   \</a>
<a name="ln97">            .samplerate = APP_SENSOR_BME280_SAMPLERATE,   \</a>
<a name="ln98">            .scale = APP_SENSOR_BME280_SCALE},            \</a>
<a name="ln99">    .nvm_file = APP_FLASH_SENSOR_FILE,                    \</a>
<a name="ln100">    .nvm_record = APP_FLASH_SENSOR_BME280_RECORD,         \</a>
<a name="ln101">    .bus = BME_BUS,                                       \</a>
<a name="ln102">    .handle = BME_HANDLE,                                 \</a>
<a name="ln103">    .pwr_pin = RB_BME280_SENSOR_POWER_PIN,                \</a>
<a name="ln104">    .pwr_on = RI_GPIO_HIGH,                               \</a>
<a name="ln105">    .fifo_pin = RI_GPIO_ID_UNUSED,                        \</a>
<a name="ln106">    .level_pin = RI_GPIO_ID_UNUSED                        \</a>
<a name="ln107">  }</a>
<a name="ln108">#endif</a>
<a name="ln109"> </a>
<a name="ln110">#if APP_SENSOR_DPS310_ENABLED</a>
<a name="ln111">#define APP_SENSOR_DPS310_DEFAULT_CFG                     \</a>
<a name="ln112">  {                                                       \</a>
<a name="ln113">    .sensor = {0},                                        \</a>
<a name="ln114">    .init = &amp;ri_dps310_init,                              \</a>
<a name="ln115">    .configuration =                                      \</a>
<a name="ln116">        {                                                 \</a>
<a name="ln117">            .dsp_function = APP_SENSOR_DPS310_DSP_FUNC,   \</a>
<a name="ln118">            .dsp_parameter = APP_SENSOR_DPS310_DSP_PARAM, \</a>
<a name="ln119">            .mode = APP_SENSOR_DPS310_MODE,               \</a>
<a name="ln120">            .resolution = APP_SENSOR_DPS310_RESOLUTION,   \</a>
<a name="ln121">            .samplerate = APP_SENSOR_DPS310_SAMPLERATE,   \</a>
<a name="ln122">            .scale = APP_SENSOR_DPS310_SCALE},            \</a>
<a name="ln123">    .nvm_file = APP_FLASH_SENSOR_FILE,                    \</a>
<a name="ln124">    .nvm_record = APP_FLASH_SENSOR_DPS310_RECORD,         \</a>
<a name="ln125">    .bus = RD_BUS_SPI,                                    \</a>
<a name="ln126">    .handle = RB_SPI_SS_ENVIRONMENTAL_PIN,                \</a>
<a name="ln127">    .pwr_pin = RB_DPS310_SENSOR_POWER_PIN,                \</a>
<a name="ln128">    .pwr_on = RI_GPIO_HIGH,                               \</a>
<a name="ln129">    .fifo_pin = RI_GPIO_ID_UNUSED,                        \</a>
<a name="ln130">    .level_pin = RI_GPIO_ID_UNUSED                        \</a>
<a name="ln131">  }</a>
<a name="ln132">#endif</a>
<a name="ln133"> </a>
<a name="ln134">#if APP_SENSOR_LIS2DH12_ENABLED</a>
<a name="ln135">#define APP_SENSOR_LIS2DH12_DEFAULT_CFG                     \</a>
<a name="ln136">  {                                                         \</a>
<a name="ln137">    .sensor = {0},                                          \</a>
<a name="ln138">    .init = &amp;ri_lis2dh12_init,                              \</a>
<a name="ln139">    .configuration =                                        \</a>
<a name="ln140">        {                                                   \</a>
<a name="ln141">            .dsp_function = APP_SENSOR_LIS2DH12_DSP_FUNC,   \</a>
<a name="ln142">            .dsp_parameter = APP_SENSOR_LIS2DH12_DSP_PARAM, \</a>
<a name="ln143">            .mode = APP_SENSOR_LIS2DH12_MODE,               \</a>
<a name="ln144">            .resolution = APP_SENSOR_LIS2DH12_RESOLUTION,   \</a>
<a name="ln145">            .samplerate = APP_SENSOR_LIS2DH12_SAMPLERATE,   \</a>
<a name="ln146">            .scale = APP_SENSOR_LIS2DH12_SCALE},            \</a>
<a name="ln147">    .nvm_file = APP_FLASH_SENSOR_FILE,                      \</a>
<a name="ln148">    .nvm_record = APP_FLASH_SENSOR_LIS2DH12_RECORD,         \</a>
<a name="ln149">    .bus = RD_BUS_SPI,                                      \</a>
<a name="ln150">    .handle = RB_SPI_SS_ACCELEROMETER_PIN,                  \</a>
<a name="ln151">    .pwr_pin = RB_LIS2DH12_SENSOR_POWER_PIN,                \</a>
<a name="ln152">    .pwr_on = RI_GPIO_HIGH,                                 \</a>
<a name="ln153">    .fifo_pin = RB_INT_FIFO_PIN,                            \</a>
<a name="ln154">    .level_pin = RB_INT_LEVEL_PIN                           \</a>
<a name="ln155">  }</a>
<a name="ln156">#endif</a>
<a name="ln157"> </a>
<a name="ln158">#if APP_SENSOR_LIS2DW12_ENABLED</a>
<a name="ln159">#define APP_SENSOR_LIS2DW2_DEFAULT_CFG                      \</a>
<a name="ln160">  {                                                         \</a>
<a name="ln161">    .sensor = {0},                                          \</a>
<a name="ln162">    .init = ri_lis2dw12_init,                               \</a>
<a name="ln163">    .configuration = {0},                                   \</a>
<a name="ln164">    .nvm_file = APPLICATION_FLASH_SENSOR_FILE,              \</a>
<a name="ln165">    .nvm_record = APPLICATION_FLASH_SENSOR_LIS2DW12_RECORD, \</a>
<a name="ln166">    .bus = RD_BUS_SPI,                                      \</a>
<a name="ln167">    .handle = RB_SPI_SS_ACCELEROMETER_PIN,                  \</a>
<a name="ln168">    .pwr_pin = RI_GPIO_ID_UNUSED,                           \</a>
<a name="ln169">    .pwr_on = RI_GPIO_HIGH,                                 \</a>
<a name="ln170">    .fifo_pin = RB_INT_ACC1_PIN,                            \</a>
<a name="ln171">    .level_pin = RB_INT_ACC2_PIN                            \</a>
<a name="ln172">  }</a>
<a name="ln173">#endif</a>
<a name="ln174"> </a>
<a name="ln175">#if APP_SENSOR_SHTCX_ENABLED</a>
<a name="ln176">#define APP_SENSOR_SHTCX_DEFAULT_CFG                     \</a>
<a name="ln177">  {                                                      \</a>
<a name="ln178">    .sensor = {0},                                       \</a>
<a name="ln179">    .init = &amp;ri_shtcx_init,                              \</a>
<a name="ln180">    .configuration =                                     \</a>
<a name="ln181">        {                                                \</a>
<a name="ln182">            .dsp_function = APP_SENSOR_SHTCX_DSP_FUNC,   \</a>
<a name="ln183">            .dsp_parameter = APP_SENSOR_SHTCX_DSP_PARAM, \</a>
<a name="ln184">            .mode = APP_SENSOR_SHTCX_MODE,               \</a>
<a name="ln185">            .resolution = APP_SENSOR_SHTCX_RESOLUTION,   \</a>
<a name="ln186">            .samplerate = APP_SENSOR_SHTCX_SAMPLERATE,   \</a>
<a name="ln187">            .scale = APP_SENSOR_SHTCX_SCALE},            \</a>
<a name="ln188">    .nvm_file = APP_FLASH_SENSOR_FILE,                   \</a>
<a name="ln189">    .nvm_record = APP_FLASH_SENSOR_SHTCX_RECORD,         \</a>
<a name="ln190">    .bus = RD_BUS_I2C,                                   \</a>
<a name="ln191">    .handle = RB_SHTCX_I2C_ADDRESS,                      \</a>
<a name="ln192">    .pwr_pin = RB_SHTCX_SENSOR_POWER_PIN,                \</a>
<a name="ln193">    .pwr_on = RI_GPIO_HIGH,                              \</a>
<a name="ln194">    .fifo_pin = RI_GPIO_ID_UNUSED,                       \</a>
<a name="ln195">    .level_pin = RI_GPIO_ID_UNUSED                       \</a>
<a name="ln196">  }</a>
<a name="ln197">#endif</a>
<a name="ln198"> </a>
<a name="ln199">#if APP_SENSOR_TMP117_ENABLED</a>
<a name="ln200">#define APP_SENSOR_TMP117_DEFAULT_CFG                     \</a>
<a name="ln201">  {                                                       \</a>
<a name="ln202">    .sensor = {0},                                        \</a>
<a name="ln203">    .init = &amp;ri_tmp117_init,                              \</a>
<a name="ln204">    .configuration =                                      \</a>
<a name="ln205">    {                                                     \</a>
<a name="ln206">            .dsp_function = APP_SENSOR_TMP117_DSP_FUNC,   \</a>
<a name="ln207">            .dsp_parameter = APP_SENSOR_TMP117_DSP_PARAM, \</a>
<a name="ln208">            .mode = APP_SENSOR_TMP117_MODE,               \</a>
<a name="ln209">            .resolution = APP_SENSOR_TMP117_RESOLUTION,   \</a>
<a name="ln210">            .samplerate = APP_SENSOR_TMP117_SAMPLERATE,   \</a>
<a name="ln211">            .scale = APP_SENSOR_TMP117_SCALE              \</a>
<a name="ln212">    },                                                    \</a>
<a name="ln213">    .nvm_file = APP_FLASH_SENSOR_FILE,                    \</a>
<a name="ln214">    .nvm_record = APP_FLASH_SENSOR_TMP117_RECORD,         \</a>
<a name="ln215">    .bus = RD_BUS_I2C,                                    \</a>
<a name="ln216">    .handle = RB_TMP117_I2C_ADDRESS,                      \</a>
<a name="ln217">    .pwr_pin = RB_TMP117_SENSOR_POWER_PIN,                \</a>
<a name="ln218">    .pwr_on = RI_GPIO_HIGH,                               \</a>
<a name="ln219">    .fifo_pin = RI_GPIO_ID_UNUSED,                        \</a>
<a name="ln220">    .level_pin = RI_GPIO_ID_UNUSED                        \</a>
<a name="ln221">  }</a>
<a name="ln222">#endif</a>
<a name="ln223"> </a>
<a name="ln224">#if APP_SENSOR_PHOTO_ENABLED</a>
<a name="ln225">#define APP_SENSOR_PHOTO_DEFAULT_CFG             \</a>
<a name="ln226">  {                                              \</a>
<a name="ln227">    .sensor = {0},                               \</a>
<a name="ln228">    .init = &amp;ri_adc_photo_init,                  \</a>
<a name="ln229">    .configuration = {0},                        \</a>
<a name="ln230">    .nvm_file = APP_FLASH_SENSOR_FILE,           \</a>
<a name="ln231">    .nvm_record = APP_FLASH_SENSOR_PHOTO_RECORD, \</a>
<a name="ln232">    .bus = RD_BUS_NONE,                          \</a>
<a name="ln233">    .handle = RB_PHOTO_ADC,                      \</a>
<a name="ln234">    .pwr_pin = RB_PHOTO_PWR_PIN,                 \</a>
<a name="ln235">    .pwr_on = RB_PHOTO_ACTIVE,                   \</a>
<a name="ln236">    .fifo_pin = RI_GPIO_ID_UNUSED,               \</a>
<a name="ln237">    .level_pin = RI_GPIO_ID_UNUSED               \</a>
<a name="ln238">  }</a>
<a name="ln239">#endif</a>
<a name="ln240"> </a>
<a name="ln241">#if APP_SENSOR_NTC_ENABLED</a>
<a name="ln242">#define APP_SENSOR_NTC_DEFAULT_CFG             \</a>
<a name="ln243">  {                                            \</a>
<a name="ln244">    .sensor = {0},                             \</a>
<a name="ln245">    .init = &amp;ri_adc_ntc_init,                  \</a>
<a name="ln246">    .configuration = {0},                      \</a>
<a name="ln247">    .nvm_file = APP_FLASH_SENSOR_FILE,         \</a>
<a name="ln248">    .nvm_record = APP_FLASH_SENSOR_NTC_RECORD, \</a>
<a name="ln249">    .bus = RD_BUS_NONE,                        \</a>
<a name="ln250">    .handle = RB_NTC_ADC,                      \</a>
<a name="ln251">    .pwr_pin = RB_NTC_PWR_PIN,                 \</a>
<a name="ln252">    .pwr_on = RB_NTC_ACTIVE,                   \</a>
<a name="ln253">    .fifo_pin = RI_GPIO_ID_UNUSED,             \</a>
<a name="ln254">    .level_pin = RI_GPIO_ID_UNUSED             \</a>
<a name="ln255">  }</a>
<a name="ln256">#endif</a>
<a name="ln257"> </a>
<a name="ln258">#if APP_SENSOR_ENVIRONMENTAL_MCU_ENABLED</a>
<a name="ln259">#define APP_SENSOR_ENVIRONMENTAL_MCU_DEFAULT_CFG         \</a>
<a name="ln260">  {                                                      \</a>
<a name="ln261">    .sensor = {0},                                       \</a>
<a name="ln262">    .init = &amp;ri_environmental_mcu_init,                  \</a>
<a name="ln263">    .configuration =                                     \</a>
<a name="ln264">    {                                                    \</a>
<a name="ln265">            .dsp_function = APP_SENSOR_NRF52_DSP_FUNC,   \</a>
<a name="ln266">            .dsp_parameter = APP_SENSOR_NRF52_DSP_PARAM, \</a>
<a name="ln267">            .mode = APP_SENSOR_NRF52_MODE,               \</a>
<a name="ln268">            .resolution = APP_SENSOR_NRF52_RESOLUTION,   \</a>
<a name="ln269">            .samplerate = APP_SENSOR_NRF52_SAMPLERATE,   \</a>
<a name="ln270">            .scale = APP_SENSOR_NRF52_SCALE              \</a>
<a name="ln271">    },                                                   \</a>
<a name="ln272">    .nvm_file = APP_FLASH_SENSOR_FILE,                   \</a>
<a name="ln273">    .nvm_record = APP_FLASH_SENSOR_ENVI_RECORD,          \</a>
<a name="ln274">    .bus = RD_BUS_NONE,                                  \</a>
<a name="ln275">    .handle = RD_BUS_NONE,                               \</a>
<a name="ln276">    .pwr_pin = RI_GPIO_ID_UNUSED,                        \</a>
<a name="ln277">    .pwr_on = RI_GPIO_LOW,                               \</a>
<a name="ln278">    .fifo_pin = RI_GPIO_ID_UNUSED,                       \</a>
<a name="ln279">    .level_pin = RI_GPIO_ID_UNUSED                       \</a>
<a name="ln280">  }</a>
<a name="ln281">#endif</a>
<a name="ln282"> </a>
<a name="ln283">/**</a>
<a name="ln284"> * @brief Initialize sensors into default mode or to a mode stored to flash.</a>
<a name="ln285"> *</a>
<a name="ln286"> * This function checks app_config.h for enabled sensors and initializes each of them</a>
<a name="ln287"> * into mode stored into flash, or into default mode defined in app_config.h if the</a>
<a name="ln288"> * mode is not stored in flash. Internal sampling rate of sensors does not affect</a>
<a name="ln289"> * reading rate of sensors, reading rate must be configured separately.</a>
<a name="ln290"> *</a>
<a name="ln291"> * @retval RD_SUCCESS on success, NOT_FOUND sensors are allowed.</a>
<a name="ln292"> * @retval RD_ERROR_INVALID_STATE if GPIO or GPIO interrupts are not enabled.</a>
<a name="ln293"> * @retval RD_ERROR_SELFTEST if sensor is found on the bus and fails selftest.</a>
<a name="ln294"> */</a>
<a name="ln295">rd_status_t app_sensor_init (void);</a>
<a name="ln296"> </a>
<a name="ln297">/**</a>
<a name="ln298"> * @brief Configure sampling of sensors.</a>
<a name="ln299"> *</a>
<a name="ln300"> * This function lets application know what data and how often should be read.</a>
<a name="ln301"> * To use sampled data, call @ref app_sensor_get.</a>
<a name="ln302"> *</a>
<a name="ln303"> * @param[in] data Data fields to sample.</a>
<a name="ln304"> * @param[in] interval_ms Interval to sample at. At minimum 1000 ms.</a>
<a name="ln305"> *</a>
<a name="ln306"> * @retval RD_SUCCESS on success.</a>
<a name="ln307"> * @retval RD_ERROR_INVALID_PARAM if interval is less than 1000 ms.</a>
<a name="ln308"> *</a>
<a name="ln309"> * @note: Future minor version may allow using intervals down to 1 ms on</a>
<a name="ln310"> *        sensors with built-in FIFOs and read the FIFO in batches.</a>
<a name="ln311"> *</a>
<a name="ln312"> */</a>
<a name="ln313">rd_status_t app_sensor_sample_config (const rd_sensor_data_fields_t data,</a>
<a name="ln314">                                      const uint32_t interval_ms);</a>
<a name="ln315"> </a>
<a name="ln316">/**</a>
<a name="ln317"> * @brief Return available data types.</a>
<a name="ln318"> *</a>
<a name="ln319"> * @note This is refreshed from sensor structs RAM which makes</a>
<a name="ln320"> * this a relatively expensive function call due to looping over</a>
<a name="ln321"> * all sensor contexts. Cache this if microseconds count in your application.</a>
<a name="ln322"> *</a>
<a name="ln323"> * @return Listing of data the application can provide.</a>
<a name="ln324"> */</a>
<a name="ln325">rd_sensor_data_fields_t app_sensor_available_data (void);</a>
<a name="ln326"> </a>
<a name="ln327">/**</a>
<a name="ln328"> * @brief Return last sampled data.</a>
<a name="ln329"> *</a>
<a name="ln330"> * This function checks loops through initialized sensors until all data in</a>
<a name="ln331"> * data-&gt;fields is valid or all sensors are checked.</a>
<a name="ln332"> *</a>
<a name="ln333"> * @retval RD_SUCCESS on success, NOT_FOUND sensors are allowed.</a>
<a name="ln334"> * @retval RD_ERROR_SELFTEST if sensor is found on the bus and fails selftest.</a>
<a name="ln335"> */</a>
<a name="ln336">rd_status_t app_sensor_get (rd_sensor_data_t * const data);</a>
<a name="ln337"> </a>
<a name="ln338">/**</a>
<a name="ln339"> * @brief Uninitialize sensors into low-power mode.</a>
<a name="ln340"> *</a>
<a name="ln341"> * @retval RD_SUCCESS On success.</a>
<a name="ln342"> * @return Error code from stack on error.</a>
<a name="ln343"> */</a>
<a name="ln344">rd_status_t app_sensor_uninit (void);</a>
<a name="ln345"> </a>
<a name="ln346">/**</a>
<a name="ln347"> * @brief Uninitialize sensors into low-power mode.</a>
<a name="ln348"> *</a>
<a name="ln349"> * @retval RD_SUCCESS On success.</a>
<a name="ln350"> * @return Error code from stack on error.</a>
<a name="ln351"> */</a>
<a name="ln352">rd_status_t app_sensor_uninit (void);</a>
<a name="ln353"> </a>
<a name="ln354">/**</a>
<a name="ln355"> * @brief Find and return a sensor which can provide requested data.</a>
<a name="ln356"> *</a>
<a name="ln357"> * Loops through sensors in order of priority, if board has SHTC temperature and</a>
<a name="ln358"> * humidity sensor and LIS2DH12 acceleration and temperature sensor, searching</a>
<a name="ln359"> * for the sensor will return the one which is first in m_sensors list.</a>
<a name="ln360"> *</a>
<a name="ln361"> * Works only witjh initialized sensors, will not return a sensor which is supported</a>
<a name="ln362"> * in firmawre but not initialized due to self-test error etc.</a>
<a name="ln363"> *</a>
<a name="ln364"> * @param[in] data fields which sensor must provide.</a>
<a name="ln365"> * @return Pointer to SENSOR, NULL if suitable sensor is not found.</a>
<a name="ln366"> * @note If parameter data is empty, first initialized sensor will be returned.</a>
<a name="ln367"> */</a>
<a name="ln368">rd_sensor_t * app_sensor_find_provider (const rd_sensor_data_fields_t data);</a>
<a name="ln369"> </a>
<a name="ln370">/**</a>
<a name="ln371"> * @brief Increment event counter of application. Rolls over at 2^32.</a>
<a name="ln372"> */</a>
<a name="ln373">void app_sensor_event_increment (void);</a>
<a name="ln374"> </a>
<a name="ln375">/**</a>
<a name="ln376"> * @brief Get current event count.</a>
<a name="ln377"> *</a>
<a name="ln378"> * @return Number of events accumulated, rolls over at int32_t.</a>
<a name="ln379"> */</a>
<a name="ln380">uint32_t app_sensor_event_count_get (void);</a>
<a name="ln381"> </a>
<a name="ln382">/**</a>
<a name="ln383"> * @brief Set threshold for accelerometer interrupts.</a>
<a name="ln384"> *</a>
<a name="ln385"> * Accelerometers are high-passed so gravity won't affect given threshold.</a>
<a name="ln386"> * Acceleration event is triggered when the threshold is exceeded on any axis.</a>
<a name="ln387"> * Acceleration event ceases when acceleration falls below the threshold, and</a>
<a name="ln388"> * can then be triggered again. Maximum rate for acceleration events is then</a>
<a name="ln389"> * accelerometer sample rate divided by two.</a>
<a name="ln390"> *</a>
<a name="ln391"> * On acceleration event @ref app_sensor_event_increment is called.</a>
<a name="ln392"> *</a>
<a name="ln393"> * @param[in, out] threshold_g In: Thershold of acceleration, &gt; 0. Interpreted as</a>
<a name="ln394"> *                                 &quot;at least this much&quot;. NULL to disable interrupts.</a>
<a name="ln395"> *                             Out: Configured threshold.</a>
<a name="ln396"> * @retval RD_SUCCESS if threshold was configured.</a>
<a name="ln397"> * @retval RD_ERROR_NOT_IMPLEMENTED if threshold is lower than 0 (negative).</a>
<a name="ln398"> * @retval RD_ERROR_NOT_SUPPORTED if no suitable accelerometer is initialized.</a>
<a name="ln399"> *</a>
<a name="ln400"> *</a>
<a name="ln401"> */</a>
<a name="ln402">rd_status_t app_sensor_acc_thr_set (float * threshold_g);</a>
<a name="ln403"> </a>
<a name="ln404">/**</a>
<a name="ln405"> * @brief Handle data coming in to the application.</a>
<a name="ln406"> *</a>
<a name="ln407"> * Interprets the desired action, executes it and aknowledges to</a>
<a name="ln408"> * reply_fp with ri_comm_message_t containing ruuvi endpoint encoded message.</a>
<a name="ln409"> *</a>
<a name="ln410"> * For example a Log Read command gets replied with all the logged elements.</a>
<a name="ln411"> *</a>
<a name="ln412"> *</a>
<a name="ln413"> * @param[in] ri_reply_fp Function pointer to send replies to.</a>
<a name="ln414"> * @param[in] raw_message Payload sent by client. Must be a standard Ruuvi Endpoint</a>
<a name="ln415"> *                        message.</a>
<a name="ln416"> * @param[in] data_len Payload sent by client.</a>
<a name="ln417"> *</a>
<a name="ln418"> * @retval RD_SUCCESS Data was handled, including replying with error to reply_fp.</a>
<a name="ln419"> * @retval RD_ERROR_NULL Raw message or replyfp is NULL.</a>
<a name="ln420"> * @retval RD_ERROR_DATA_SIZE data_len is less than RE_STANDARD_MESSAGE_LENGTH.</a>
<a name="ln421"> *</a>
<a name="ln422"> * @warning Executing these commands can be resource intensive. Consider</a>
<a name="ln423"> *          stopping app_heartbeat before entering this function.</a>
<a name="ln424"> *</a>
<a name="ln425"> */</a>
<a name="ln426">rd_status_t app_sensor_handle (const ri_comm_xfer_fp_t ri_reply_fp,</a>
<a name="ln427">                               const uint8_t * const raw_message,</a>
<a name="ln428">                               const uint16_t data_len);</a>
<a name="ln429"> </a>
<a name="ln430">/**</a>
<a name="ln431"> * @brief Synchronize VDD measurement to radio activity.</a>
<a name="ln432"> *</a>
<a name="ln433"> * Call this function before and after radio events to notify</a>
<a name="ln434"> * the device that ADC should be prepared to sample the droop voltage</a>
<a name="ln435"> * and to take the sample after heavy loading.</a>
<a name="ln436"> *</a>
<a name="ln437"> * @param[in] evt Type of next radio event, RI_RADIO_BEFORE ot RI_RADIO_AFTER</a>
<a name="ln438"> */</a>
<a name="ln439">void app_sensor_vdd_measure_isr (const ri_radio_activity_evt_t evt);</a>
<a name="ln440"> </a>
<a name="ln441">/**</a>
<a name="ln442"> * @brief Prepare VDD and take a sample</a>
<a name="ln443"> *</a>
<a name="ln444"> * Call this function during initialization process to take a VDD sample</a>
<a name="ln445"> * for the first heartbeat message.</a>
<a name="ln446"> *</a>
<a name="ln447"> * @retval RD_SUCCESS on success</a>
<a name="ln448"> * @retval RD_ERROR_INVALID_STATE if ADC is not prepared</a>
<a name="ln449"> */</a>
<a name="ln450">rd_status_t app_sensor_vdd_sample (void);</a>
<a name="ln451"> </a>
<a name="ln452">#ifdef RUUVI_RUN_TESTS</a>
<a name="ln453">void app_sensor_ctx_get (rt_sensor_ctx_t *** m_sensors, size_t * num_sensors);</a>
<a name="ln454">#endif</a>
<a name="ln455"> </a>
<a name="ln456">#ifdef CEEDLING</a>
<a name="ln457">#include &quot;ruuvi_interface_communication_radio.h&quot;</a>
<a name="ln458">#include &quot;ruuvi_interface_gpio_interrupt.h&quot;</a>
<a name="ln459">void on_radio_isr (const ri_radio_activity_evt_t evt);</a>
<a name="ln460">void on_accelerometer_isr (const ri_gpio_evt_t event);</a>
<a name="ln461">#endif</a>
<a name="ln462"> </a>
<a name="ln463">#endif</a>
<a name="ln464">/** @}*/</a>

</code></pre>
<div class="balloon" rel="352"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v2622/" target="_blank">V2622</a> External objects and functions should be declared once in only one file. The 'app_sensor_uninit' identifier is already declared here: 'app_sensor.h:344'.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
