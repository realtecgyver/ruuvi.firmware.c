
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ruuvi_interface_lis2dh12.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#ifndef RUUVI_INTERFACE_LIS2DH12_H</a>
<a name="ln2">#define RUUVI_INTERFACE_LIS2DH12_H</a>
<a name="ln3">#include &quot;ruuvi_driver_enabled_modules.h&quot;</a>
<a name="ln4">#if (RI_LIS2DH12_ENABLED || DOXYGEN)</a>
<a name="ln5">#include &quot;ruuvi_driver_error.h&quot;</a>
<a name="ln6">#include &quot;ruuvi_driver_sensor.h&quot;</a>
<a name="ln7"> </a>
<a name="ln8">#include &lt;stdbool.h&gt;</a>
<a name="ln9">#include &lt;stddef.h&gt;</a>
<a name="ln10">#include &lt;stddef.h&gt;</a>
<a name="ln11">#include &quot;lis2dh12_reg.h&quot;</a>
<a name="ln12"> </a>
<a name="ln13">/**</a>
<a name="ln14"> * @addtogroup Acceleration</a>
<a name="ln15"> */</a>
<a name="ln16">/** @{ */</a>
<a name="ln17">/**</a>
<a name="ln18"> * @defgroup LIS2DH12 LIS2DH12 Inteface</a>
<a name="ln19"> * @brief Implement @ref rd_sensor_t functions on LIS2DH12</a>
<a name="ln20"> *</a>
<a name="ln21"> * The implementation supports</a>
<a name="ln22"> * different resolutions, samplerates, high-passing, activity interrupt</a>
<a name="ln23"> * and FIFO.</a>
<a name="ln24"> */</a>
<a name="ln25">/** @} */</a>
<a name="ln26">/**</a>
<a name="ln27"> * @addtogroup LIS2DH12</a>
<a name="ln28"> */</a>
<a name="ln29">/** @{ */</a>
<a name="ln30">/**</a>
<a name="ln31"> * @file ruuvi_interface_lis2dh12.h</a>
<a name="ln32"> * @author Otso Jousimaa &lt;otso@ojousima.net&gt;</a>
<a name="ln33"> * @date 2020-04-24</a>
<a name="ln34"> * @copyright Ruuvi Innovations Ltd, license BSD-3-Clause.</a>
<a name="ln35"> *</a>
<a name="ln36"> * Interface for LIS2DH12 basic usage. The underlying platform must provide</a>
<a name="ln37"> * functions for SPI and/or I2C access, @ref ruuvi_interface_spi_lis2dh12.h.</a>
<a name="ln38"> *</a>
<a name="ln39"> * Testing the interface with @ref ruuvi_driver_sensor_test.h</a>
<a name="ln40"> *</a>
<a name="ln41"> * @code{.c}</a>
<a name="ln42"> *  rd_status_t err_code = RD_SUCCESS;</a>
<a name="ln43"> *  rd_bus_t bus = RD_BUS_NONE;</a>
<a name="ln44"> *  uint8_t handle = 0;</a>
<a name="ln45"> *  rd_sensor_init_fp init = ri_lis2dh12_init;</a>
<a name="ln46"> *  bus = RD_BUS_SPI;</a>
<a name="ln47"> *  handle = RUUVI_BOARD_SPI_SS_ACCELEROMETER_PIN;</a>
<a name="ln48"> *  err_code = test_sensor_init(init, bus, handle);</a>
<a name="ln49"> *  err_code = test_sensor_setup(init, bus, handle);</a>
<a name="ln50"> *  err_code = test_sensor_modes(init, bus, handle);</a>
<a name="ln51"> *  RD_ERROR_CHECK(err_code, RD_ERROR_SELFTEST);</a>
<a name="ln52"> * @endcode</a>
<a name="ln53"> */</a>
<a name="ln54"> </a>
<a name="ln55">/** @brief Minimum counts of self-test change in 10 bit resolution 2 G scale, ref datasheet.*/</a>
<a name="ln56">#define RI_LIS2DH12_SELFTEST_DIFF_MIN (17)</a>
<a name="ln57">/** @brief Maximum counts of self-test change in 10 bit resolution 2 G scale, ref datasheet.*/</a>
<a name="ln58">#define RI_LIS2DH12_SELFTEST_DIFF_MAX (360)</a>
<a name="ln59">/** @brief Scale used on &quot;default&quot; setting. */</a>
<a name="ln60">#define RI_LIS2DH12_DEFAULT_SCALE (2U)</a>
<a name="ln61">/** @brief Resolution used on &quot;default&quot; setting. */</a>
<a name="ln62">#define RI_LIS2DH12_DEFAULT_RESOLUTION (10U)</a>
<a name="ln63">#define LIS_SUCCESS (0)  //!&lt; No error in LIS driver.</a>
<a name="ln64">#define SELF_TEST_DELAY_MS (100U) //!&lt; At least 3 samples at 400 Hz, but recommended value 100</a>
<a name="ln65">#define SELF_TEST_SAMPLES_NUM (5) //!&lt; 5 samples</a>
<a name="ln66"> </a>
<a name="ln67">/** @brief @ref rd_sensor_init_fp */</a>
<a name="ln68">rd_status_t ri_lis2dh12_init (rd_sensor_t * acceleration_sensor, rd_bus_t bus,</a>
<a name="ln69">                              uint8_t handle);</a>
<a name="ln70">/** @brief @ref rd_sensor_init_fp */</a>
<a name="ln71">rd_status_t ri_lis2dh12_uninit (rd_sensor_t * acceleration_sensor, rd_bus_t bus,</a>
<a name="ln72">                                uint8_t handle);</a>
<a name="ln73">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln74">rd_status_t ri_lis2dh12_samplerate_set (uint8_t * samplerate);</a>
<a name="ln75">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln76">rd_status_t ri_lis2dh12_samplerate_get (uint8_t * samplerate);</a>
<a name="ln77">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln78">rd_status_t ri_lis2dh12_resolution_set (uint8_t * resolution);</a>
<a name="ln79">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln80">rd_status_t ri_lis2dh12_resolution_get (uint8_t * resolution);</a>
<a name="ln81">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln82">rd_status_t ri_lis2dh12_scale_set (uint8_t * scale);</a>
<a name="ln83">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln84">rd_status_t ri_lis2dh12_scale_get (uint8_t * scale);</a>
<a name="ln85">/** @brief @ref rd_sensor_dsp_fp */</a>
<a name="ln86">rd_status_t ri_lis2dh12_dsp_set (uint8_t * dsp, uint8_t * parameter);</a>
<a name="ln87">/** @brief @ref rd_sensor_dsp_fp */</a>
<a name="ln88">rd_status_t ri_lis2dh12_dsp_get (uint8_t * dsp, uint8_t * parameter);</a>
<a name="ln89">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln90">rd_status_t ri_lis2dh12_mode_set (uint8_t *);</a>
<a name="ln91">/** @brief @ref rd_sensor_setup_fp */</a>
<a name="ln92">rd_status_t ri_lis2dh12_mode_get (uint8_t *);</a>
<a name="ln93">/** @brief @ref rd_sensor_data_fp */</a>
<a name="ln94">rd_status_t ri_lis2dh12_data_get (rd_sensor_data_t * const data);</a>
<a name="ln95"> </a>
<a name="ln96">/**</a>
<a name="ln97">* @brief Enable 32-level FIFO in LIS2DH12</a>
<a name="ln98">* If FIFO is enabled, values are stored on LIS2DH12 FIFO and oldest element is returned on data read.</a>
<a name="ln99">*</a>
<a name="ln100">* @param[in] enable true to enable FIFO, false to disable or reset FIFO.</a>
<a name="ln101">* @return RD_SUCCESS on success, error code from stack on error.</a>
<a name="ln102">*/</a>
<a name="ln103">rd_status_t ri_lis2dh12_fifo_use (const bool enable);</a>
<a name="ln104"> </a>
<a name="ln105">/**</a>
<a name="ln106">* @brief Read FIFO</a>
<a name="ln107">* Reads up to num_elements data points from FIFO and populates pointer data with them</a>
<a name="ln108">*</a>
<a name="ln109">* @param[in, out] num_elements Input: number of elements in data. Output: Number of elements placed in data</a>
<a name="ln110">* @param[out] data array with num_elements slots.</a>
<a name="ln111">* @return RD_SUCCESS on success</a>
<a name="ln112">* @return RD_ERROR_NULL if either parameter is NULL</a>
<a name="ln113">* @return RD_ERROR_INVALID_STATE if FIFO is not in use</a>
<a name="ln114">* @return error code from stack on error.</a>
<a name="ln115">*/</a>
<a name="ln116">rd_status_t ri_lis2dh12_fifo_read (size_t * num_elements, rd_sensor_data_t * data);</a>
<a name="ln117"> </a>
<a name="ln118">/**</a>
<a name="ln119">* @brief Enable FIFO full interrupt on LIS2DH12.</a>
<a name="ln120">* Triggers as ACTIVE HIGH interrupt once FIFO has 32 elements.</a>
<a name="ln121">*</a>
<a name="ln122">* @param[in] enable True to enable interrupt, false to disable interrupt</a>
<a name="ln123">* @return RD_SUCCESS on success, error code from stack otherwise.</a>
<a name="ln124">**/</a>
<a name="ln125">rd_status_t ri_lis2dh12_fifo_interrupt_use (const bool enable);</a>
<a name="ln126"> </a>
<a name="ln127">/**</a>
<a name="ln128"> * @brief Enable activity interrupt on LIS2DH12.</a>
<a name="ln129"> *</a>
<a name="ln130"> * Triggers as ACTIVE HIGH interrupt while detected movement is above threshold limit_g</a>
<a name="ln131"> * Axes are high-passed for this interrupt, i.e. gravity won't trigger the interrupt</a>
<a name="ln132"> * Axes are examined individually, compound acceleration won't trigger the interrupt.</a>
<a name="ln133"> *</a>
<a name="ln134"> * @param[in] enable  True to enable interrupt, false to disable interrupt</a>
<a name="ln135"> * @param[in, out] limit_g: Desired acceleration to trigger the interrupt.</a>
<a name="ln136"> *                    Is considered as &quot;at least&quot;, the acceleration is rounded up to next value.</a>
<a name="ln137"> *                    Is written with value that was set to interrupt</a>
<a name="ln138"> * @return RD_SUCCESS on success</a>
<a name="ln139"> * @return RD_ERROR_NULL if limit_g is NULL</a>
<a name="ln140"> * @return RD_INVALID_STATE if acceleration limit is higher than maximum scale</a>
<a name="ln141"> * @return error code from stack on other error.</a>
<a name="ln142"> *</a>
<a name="ln143"> */</a>
<a name="ln144">rd_status_t ri_lis2dh12_activity_interrupt_use (const bool enable,</a>
<a name="ln145">        float * limit_g);</a>
<a name="ln146"> </a>
<a name="ln147">/** @brief context for LIS2DH12 */</a>
<a name="ln148">typedef struct</a>
<a name="ln149">{</a>
<a name="ln150">    lis2dh12_op_md_t resolution; //!&lt; Resolution, bits. 8, 10, or 12.</a>
<a name="ln151">    lis2dh12_fs_t scale;         //!&lt; Scale, gravities. 2, 4, 8 or 16.</a>
<a name="ln152">    lis2dh12_odr_t samplerate;   //!&lt; Sample rate, 1 ... 200, or custom values for higher.</a>
<a name="ln153">    lis2dh12_st_t selftest;      //!&lt; Self-test enabled, positive, negative or disabled.</a>
<a name="ln154">    uint8_t mode;                //!&lt; Operating mode. Sleep, single or continuous.</a>
<a name="ln155">    uint8_t handle;              //!&lt; Device handle, SPI GPIO pin or I2C address.</a>
<a name="ln156">    uint64_t tsample;            //!&lt; Time of sample, @ref rd_sensor_timestamp_get</a>
<a name="ln157">    stmdev_ctx_t ctx;            //!&lt; Driver control structure</a>
<a name="ln158">} ri_lis2dh12_dev;</a>
<a name="ln159"> </a>
<a name="ln160">/** @} */</a>
<a name="ln161"> </a>
<a name="ln162">#ifdef CEEDLING</a>
<a name="ln163">// Give CEEDLING a handle to context.</a>
<a name="ln164">extern ri_lis2dh12_dev dev;</a>
<a name="ln165">#endif // CEEDLING</a>
<a name="ln166"> </a>
<a name="ln167">#endif // IF enabled</a>
<a name="ln168">#endif // Include guard</a>

</code></pre>
<div class="balloon" rel="90"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v2601/" target="_blank">V2601</a> Functions should be declared in prototype form with named parameters.</p></div>
<div class="balloon" rel="92"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v2601/" target="_blank">V2601</a> Functions should be declared in prototype form with named parameters.</p></div>
<div class="balloon" rel="144"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v2614/" target="_blank">V2614</a> External identifiers should be distinct. The identifier must contain fewer than 32 characters.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
